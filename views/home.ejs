<% 
  const active = 'for-you';
%>

<div class="home-container">
  <section class="featured-carousel">
    <div class="carousel-container">
      <div class="carousel-track" id="carouselTrack">
        <!-- First Slide -->
        <div class="carousel-slide">
          <div class="slide-content">
            <h2>1 Minute To Boost Your Sales</h2>
            <p>Right Product, High Commission</p>
            <div class="view-count">
              <span class="view-icon"><i class="fas fa-eye"></i></span>
              <span class="view-number">68.9k View</span>
            </div>
            <a href="#product-categories" class="view-now-btn">View now <i class="fas fa-chevron-right"></i></a>
          </div>
          <div class="slide-bg" style="background-image: url('/images/banners/banner1.jpg');"></div>
        </div>
        
        <!-- Second Slide -->
        <div class="carousel-slide">
          <div class="slide-content">
            <h2>Earn More With Top Products</h2>
            <p>High Commission, Easy to Promote</p>
            <div class="view-count">
              <span class="view-icon"><i class="fas fa-fire"></i></span>
              <span class="view-number">Trending Now</span>
            </div>
            <a href="/products/hot" class="view-now-btn">Hot Products <i class="fas fa-chevron-right"></i></a>
          </div>
          <div class="slide-bg" style="background-image: url('/images/banners/banner2.jpg');"></div>
        </div>
        
        <!-- Third Slide -->
        <div class="carousel-slide">
          <div class="slide-content">
            <h2>Viral Products Collection</h2>
            <p>Products That Sell Themselves</p>
            <div class="view-count">
              <span class="view-icon"><i class="fas fa-chart-line"></i></span>
              <span class="view-number">Viral Picks</span>
            </div>
            <a href="/products/viral" class="view-now-btn">Explore <i class="fas fa-chevron-right"></i></a>
          </div>
          <div class="slide-bg" style="background-image: url('/images/banners/banner3.jpg');"></div>
        </div>
      </div>
      
      <!-- Navigation Dots -->
      <div class="carousel-dots" id="carouselDots">
        <button class="dot active" data-index="0"></button>
        <button class="dot" data-index="1"></button>
        <button class="dot" data-index="2"></button>
      </div>
      
      <!-- Navigation Arrows -->
      <button class="carousel-arrow prev" id="prevSlide"><i class="fas fa-chevron-left"></i></button>
      <button class="carousel-arrow next" id="nextSlide"><i class="fas fa-chevron-right"></i></button>
    </div>
  </section>
  
  <section id="product-categories" class="product-categories">
    <div class="category-items">
      <a href="/products/category/text" class="category-item">
        <div class="category-icon">
          <i class="fas fa-comment-alt"></i>
        </div>
        <span>Text Product</span>
      </a>
      
      <a href="/products/viral" class="category-item">
        <div class="category-icon hot">
          <i class="fas fa-video"></i>
        </div>
        <span>Video Viral</span>
      </a>
      
      <a href="/products/category/live" class="category-item">
        <div class="category-icon">
          <i class="fas fa-broadcast-tower"></i>
        </div>
        <span>Live Stream Viral</span>
      </a>
      
      <a href="/products/top-rated" class="category-item">
        <div class="category-icon">
          <i class="fas fa-star"></i>
        </div>
        <span>Top Rating</span>
      </a>
      
      <a href="/faq" class="category-item">
        <div class="category-icon">
          <i class="fas fa-question-circle"></i>
        </div>
        <span>FAQ</span>
      </a>
    </div>
  </section>
  
  <section class="viral-product">
    <div class="section-header">
      <h2>Daily Viral Product</h2>
      <a href="/products/viral" class="view-all">View All</a>
    </div>
    
    <div class="product-grid">
      <% viralProducts.forEach(product => { %>
        <div class="product-card">
          <div class="product-image">
            <img src="<%= product.image %>" alt="<%= product.name %>">
            <% if (product.discountPercentage > 0) { %>
              <span class="discount-badge">-<%= product.discountPercentage %>%</span>
            <% } %>
            <div class="viral-badge">Viral New</div>
          </div>
          <div class="product-info">
            <h3 class="product-name"><%= product.name %></h3>
            <div class="product-stats">
              <span class="product-views"><%= (product.views / 1000).toFixed(1) %>k</span>
              <span class="product-likes"><%= (product.views * 0.15).toFixed(1) %>k</span>
            </div>
            <a href="/products/<%= product._id %>" class="view-product-btn">View Product</a>
          </div>
        </div>
      <% }); %>
    </div>
  </section>
  
  <section class="easy-to-sell">
    <div class="section-header">
      <h2>Produk Komisi Tertinggi</h2>
      <a href="/products?sort=commission-high" class="view-all">View All</a>
    </div>
    
    <div class="slider-container">
      <button class="slider-nav prev" id="prevHighComm">
        <i class="fas fa-chevron-left"></i>
      </button>
      
      <div class="product-slider" id="highCommSlider">
        <% if (highCommissionProducts && highCommissionProducts.length > 0) { %>
          <% highCommissionProducts.forEach(product => { %>
            <div class="product-slide">
              <div class="product-card high-comm-card">
                <div class="product-image">
                  <a href="/products/<%= product._id %>">
                    <img src="<%= product.image %>" alt="<%= product.name %>">
                  </a>
                  <% if (product.discountPercentage > 0) { %>
                    <div class="discount-badge">-<%= product.discountPercentage %>%</div>
                  <% } %>
                  <% if (product.highCommission) { %>
                    <div class="high-commission-badge">Komisi Tinggi</div>
                  <% } %>
                </div>
                <div class="product-info">
                  <h3 class="product-name">
                    <a href="/products/<%= product._id %>"><%= product.name.length > 30 ? product.name.substring(0, 30) + '...' : product.name %></a>
                  </h3>
                  <div class="product-price">
                    <% if (product.discountPrice && product.discountPrice > 0) { %>
                      <span class="original-price">Rp <%= product.price.toLocaleString('id-ID') %></span>
                      <span class="discount-price">Rp <%= product.discountPrice.toLocaleString('id-ID') %></span>
                    <% } else { %>
                      <span class="current-price">Rp <%= product.price.toLocaleString('id-ID') %></span>
                    <% } %>
                  </div>
                  <div class="product-commission">
                    <span>Komisi: <%= typeof formatCurrency !== 'undefined' ? formatCurrency(product.totalCommission || (product.price * product.commission / 100)) : 'Rp ' + (product.totalCommission || (product.price * product.commission / 100)).toLocaleString('id-ID') %></span>
                  </div>
                </div>
              </div>
            </div>
          <% }); %>
        <% } else { %>
          <div class="no-products-message">
            <p>Belum ada produk dengan komisi tinggi</p>
          </div>
        <% } %>
      </div>
      
      <button class="slider-nav next" id="nextHighComm">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </section>
  
  
  <section class="product-reviews-section">
    <div class="container">
      <div class="section-header">
        <h2>Latest Product Reviews</h2>
        <a href="/blog" class="view-all-link">View All <i class="fas fa-arrow-right"></i></a>
      </div>
      
      <div class="reviews-grid">
        <% if (locals.recentBlogPosts && recentBlogPosts.length > 0) { %>
          <% recentBlogPosts.slice(0, 3).forEach(post => { %>
            <div class="review-card">
              <a href="/blog/post/<%= post.slug %>" class="review-image">
                <img src="<%= post.thumbnail %>" alt="<%= post.title %>" loading="lazy">
                <% if (post.category) { %>
                  <span class="review-category"><%= post.category.name %></span>
                <% } %>
              </a>
              <div class="review-info">
                <h3 class="review-title">
                  <a href="/blog/post/<%= post.slug %>"><%= post.title %></a>
                </h3>
                <p class="review-meta">
                  <span class="review-date"><i class="far fa-calendar-alt"></i> <%= new Date(post.publishedAt).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' }) %></span>
                </p>
                <div class="review-summary">
                  <%= post.summary && post.summary.length > 80 ? post.summary.substring(0, 80) + '...' : post.summary %>
                </div>
                <a href="/blog/post/<%= post.slug %>" class="read-more">Read Review <i class="fas fa-chevron-right"></i></a>
              </div>
            </div>
          <% }); %>
        <% } else { %>
          <div class="no-reviews">
            <p>No product reviews available at the moment.</p>
          </div>
        <% } %>
      </div>
    </div>
  </section>
  

</div>
<style>
  .product-reviews-section {
    padding: 60px 0;
    background-color: #f8f9fa;
  }
  
  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 30px;
  }
  
  .section-header h2 {
    font-size: 28px;
    font-weight: 700;
    color: #333;
    margin: 0;
  }
  
  .view-all-link {
    color: var(--primary-color);
    font-weight: 500;
    font-size: 16px;
    transition: color 0.2s;
  }
  
  .view-all-link i {
    font-size: 14px;
    margin-left: 5px;
    transition: transform 0.2s;
  }
  
  .view-all-link:hover {
    color: #d02f50;
  }
  
  .view-all-link:hover i {
    transform: translateX(3px);
  }
  
  .reviews-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 25px;
  }
  
  .review-card {
    background-color: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    transition: transform 0.3s, box-shadow 0.3s;
  }
  
  .review-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  }
  
  .review-image {
    position: relative;
    display: block;
    height: 200px;
    overflow: hidden;
  }
  
  .review-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
  }
  
  .review-card:hover .review-image img {
    transform: scale(1.05);
  }
  
  .review-category {
    position: absolute;
    top: 15px;
    right: 15px;
    background-color: var(--primary-color);
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 12px;
    font-weight: 500;
  }
  
  .review-info {
    padding: 20px;
  }
  
  .review-title {
    font-size: 18px;
    font-weight: 600;
    margin: 0 0 10px 0;
    line-height: 1.4;
  }
  
  .review-title a {
    color: #333;
    transition: color 0.2s;
  }
  
  .review-title a:hover {
    color: var(--primary-color);
  }
  
  .review-meta {
    display: flex;
    gap: 15px;
    font-size: 13px;
    color: #777;
    margin-bottom: 10px;
  }
  
  .review-meta i {
    margin-right: 5px;
  }
  
  .review-summary {
    margin-bottom: 15px;
    color: #666;
    line-height: 1.6;
    font-size: 14px;
  }
  
  .read-more {
    display: inline-block;
    color: var(--secondary-color);
    font-size: 14px;
    font-weight: 500;
    transition: color 0.2s;
  }
  
  .read-more i {
    margin-left: 5px;
    transition: transform 0.2s;
  }
  
  .read-more:hover {
    color: var(--primary-color);
  }
  
  .read-more:hover i {
    transform: translateX(3px);
  }
  
  .no-reviews {
    grid-column: 1 / -1;
    background-color: white;
    border-radius: 10px;
    padding: 30px;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  }
  
  @media (min-width: 768px) {
    .reviews-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  @media (min-width: 992px) {
    .reviews-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  .product-reviews {
    margin-bottom: 30px;
  }
  
  .reviews-slider-container {
    position: relative;
    margin: 0 -5px;
  }
  
  .reviews-slider {
    display: flex;
    overflow-x: auto;
    scroll-behavior: smooth;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* Internet Explorer and Edge */
    padding: 10px 30px;
    gap: 20px;
  }
  
  .reviews-slider::-webkit-scrollbar {
    display: none; /* Chrome, Safari, and Opera */
  }
  
  .review-slide {
    flex: 0 0 auto;
    width: 300px;
    max-width: 90%;
  }
  
  .review-card {
    background-color: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    height: 100%;
    display: flex;
    flex-direction: column;
    transition: transform 0.3s, box-shadow 0.3s;
  }
  
  .review-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
  }
  
  .review-image {
    position: relative;
    height: 160px;
    overflow: hidden;
  }
  
  .review-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s;
  }
  
  .review-card:hover .review-image img {
    transform: scale(1.05);
  }
  
  .review-category {
    position: absolute;
    top: 10px;
    left: 10px;
    background-color: var(--primary-color);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 500;
  }
  
  .review-content {
    padding: 15px;
    display: flex;
    flex-direction: column;
    flex-grow: 1;
  }
  
  .review-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 8px;
    line-height: 1.4;
    height: 44px;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
  
  .review-title a {
    color: #333;
    transition: color 0.2s;
  }
  
  .review-title a:hover {
    color: var(--primary-color);
  }
  
  .review-summary {
    color: #666;
    font-size: 13px;
    margin-bottom: 15px;
    line-height: 1.5;
    flex-grow: 1;
    height: 58px;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
  }
  
  .review-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
    margin-top: auto;
  }
  
  .review-date {
    color: #888;
  }
  
  .review-date i {
    margin-right: 4px;
  }
  
  .read-more {
    color: var(--primary-color);
    font-weight: 500;
    transition: all 0.2s;
    display: flex;
    align-items: center;
  }
  
  .read-more i {
    font-size: 8px;
    margin-left: 3px;
    transition: transform 0.2s;
  }
  
  .read-more:hover {
    color: #d02f50;
  }
  
  .read-more:hover i {
    transform: translateX(3px);
  }
  
  .slider-nav {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background-color: white;
    border: 1px solid #eee;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 2;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    transition: all 0.2s;
  }
  
  .slider-nav:hover {
    background-color: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
  }
  
  .reviews-prev-btn {
    left: 10px;
  }
  
  .reviews-next-btn {
    right: 10px;
  }
  
  .no-reviews-message {
    width: 100%;
    padding: 30px;
    text-align: center;
    color: #888;
    font-style: italic;
  }
  
  @media (max-width: 768px) {
    .review-slide {
      width: 260px;
    }
    
    .reviews-slider {
      padding: 10px 20px;
    }
    
    .slider-nav {
      width: 30px;
      height: 30px;
    }
  }
  
  @media (max-width: 576px) {
    .review-slide {
      width: 220px;
    }
    
    .reviews-slider {
      padding: 5px 20px;
    }
  }
</style>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const reviewsSlider = document.getElementById('reviewsSlider');
    const prevReviewBtn = document.getElementById('prevReview');
    const nextReviewBtn = document.getElementById('nextReview');
    
    if (reviewsSlider && prevReviewBtn && nextReviewBtn) {
      const scrollAmount = () => {
        const slide = reviewsSlider.querySelector('.review-slide');
        if (!slide) return 0;
        
        // Get slide width + gap
        return slide.offsetWidth + 20;
      };
      
      const scrollPrev = () => {
        reviewsSlider.scrollBy({
          left: -scrollAmount(),
          behavior: 'smooth'
        });
        
        setTimeout(updateButtonStates, 350);
      };
      
      const scrollNext = () => {
        reviewsSlider.scrollBy({
          left: scrollAmount(),
          behavior: 'smooth'
        });
        
        setTimeout(updateButtonStates, 350);
      };
      
      const updateButtonStates = () => {
        const isAtStart = reviewsSlider.scrollLeft < 10;
        const isAtEnd = reviewsSlider.scrollLeft >= reviewsSlider.scrollWidth - reviewsSlider.clientWidth - 10;
        
        prevReviewBtn.style.opacity = isAtStart ? '0.5' : '1';
        nextReviewBtn.style.opacity = isAtEnd ? '0.5' : '1';
        
        prevReviewBtn.disabled = isAtStart;
        nextReviewBtn.disabled = isAtEnd;
      };
      
      // Touch events for mobile swipe
      let touchStartX = 0;
      let touchEndX = 0;
      
      const handleTouchStart = (e) => {
        touchStartX = e.changedTouches[0].screenX;
      };
      
      const handleTouchEnd = (e) => {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
      };
      
      const handleSwipe = () => {
        const swipeThreshold = 50;
        const swipeDistance = touchStartX - touchEndX;
        
        if (Math.abs(swipeDistance) > swipeThreshold) {
          if (swipeDistance > 0) {
            // Swipe left
            scrollNext();
          } else {
            // Swipe right
            scrollPrev();
          }
        }
      };
      
      // Add event listeners
      prevReviewBtn.addEventListener('click', scrollPrev);
      nextReviewBtn.addEventListener('click', scrollNext);
      reviewsSlider.addEventListener('scroll', updateButtonStates);
      
      // Touch events
      reviewsSlider.addEventListener('touchstart', handleTouchStart, { passive: true });
      reviewsSlider.addEventListener('touchend', handleTouchEnd, { passive: true });
      
      // Initial button states
      updateButtonStates();
      
      // Update on resize
      window.addEventListener('resize', () => {
        setTimeout(updateButtonStates, 200);
      });
    }
    //sampai
    
    const track = document.getElementById('carouselTrack');
    const slides = Array.from(track.children);
    const dots = Array.from(document.querySelectorAll('.carousel-dots .dot'));
    const nextButton = document.getElementById('nextSlide');
    const prevButton = document.getElementById('prevSlide');
    
    let currentIndex = 0;
    let startX;
    let isDragging = false;
    let autoplayInterval;
    
    // Set initial position
    positionSlides();
    
    // Position slides next to each other
    function positionSlides() {
      track.style.transform = `translateX(${-currentIndex * 100}%)`;
      updateDots();
    }
    
    // Update active dot
    function updateDots() {
      dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === currentIndex);
      });
    }
    
    // Navigate to specific slide
    function goToSlide(index) {
      // Make sure index is within bounds
      if (index < 0) {
        index = slides.length - 1;
      } else if (index >= slides.length) {
        index = 0;
      }
      
      currentIndex = index;
      positionSlides();
      resetAutoplay();
    }
    
    // Handle dot clicks
    dots.forEach(dot => {
      dot.addEventListener('click', e => {
        const targetIndex = parseInt(dot.getAttribute('data-index'));
        goToSlide(targetIndex);
      });
    });
    
    // Handle next/prev buttons
    nextButton.addEventListener('click', () => {
      goToSlide(currentIndex + 1);
    });
    
    prevButton.addEventListener('click', () => {
      goToSlide(currentIndex - 1);
    });
    
    // Touch events for swipe
    track.addEventListener('touchstart', e => {
      startX = e.touches[0].clientX;
      isDragging = true;
      // Pause transition during drag
      track.style.transition = 'none';
    }, { passive: true });
    
    track.addEventListener('touchmove', e => {
      if (!isDragging) return;
      
      const currentX = e.touches[0].clientX;
      const diff = startX - currentX;
      
      // Calculate how much to move
      const moveX = -currentIndex * 100 - (diff / track.offsetWidth) * 100;
      
      // Apply the transform 
      track.style.transform = `translateX(${moveX}%)`;
    }, { passive: true });
    
    track.addEventListener('touchend', e => {
      if (!isDragging) return;
      
      isDragging = false;
      track.style.transition = 'transform 0.5s ease';
      
      const currentX = e.changedTouches[0].clientX;
      const diff = startX - currentX;
      
      // Determine if we should change slides based on swipe distance
      if (Math.abs(diff) > track.offsetWidth / 4) {
        if (diff > 0) {
          // Swiped left, go to next
          goToSlide(currentIndex + 1);
        } else {
          // Swiped right, go to previous
          goToSlide(currentIndex - 1);
        }
      } else {
        // Not enough swipe distance, snap back
        positionSlides();
      }
    }, { passive: true });
    
    // Setup autoplay
    function startAutoplay() {
      autoplayInterval = setInterval(() => {
        goToSlide(currentIndex + 1);
      }, 5000); // Change slide every 5 seconds
    }
    
    function resetAutoplay() {
      clearInterval(autoplayInterval);
      startAutoplay();
    }
    
    // Handle visibility change to pause/resume autoplay
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        clearInterval(autoplayInterval);
      } else {
        startAutoplay();
      }
    });
    
    // Start autoplay
    startAutoplay();
    
    // Prevent autoplay issues when switching tabs or windows
    window.addEventListener('focus', resetAutoplay);
    window.addEventListener('blur', () => clearInterval(autoplayInterval));


    const slider = document.getElementById('highCommSlider');
    const prevBtn = document.getElementById('prevHighComm');
    const nextBtn = document.getElementById('nextHighComm');
    
    if (!slider || !prevBtn || !nextBtn) return;
    
    // Get the width of one slide plus gap
    const getScrollAmount = () => {
      const slide = slider.querySelector('.product-slide');
      if (!slide) return 0;
      
      // Get slide width + gap
      return slide.offsetWidth + 15;
    };
    
    // Scroll left/right by one slide
    const scrollPrev = () => {
      slider.scrollBy({
        left: -getScrollAmount(),
        behavior: 'smooth'
      });
    };
    
    const scrollNext = () => {
      slider.scrollBy({
        left: getScrollAmount(),
        behavior: 'smooth'
      });
    };
    
    // Update button states based on scroll position
    const updateButtonStates = () => {
      const isAtStart = slider.scrollLeft < 10;
      const isAtEnd = slider.scrollLeft >= slider.scrollWidth - slider.clientWidth - 10;
      
      prevBtn.classList.toggle('disabled', isAtStart);
      nextBtn.classList.toggle('disabled', isAtEnd);
    };
    
    // Mobile touch handling
    let touchStartX = 0;
    let touchEndX = 0;
    
    const handleTouchStart = (e) => {
      touchStartX = e.changedTouches[0].screenX;
    };
    
    const handleTouchEnd = (e) => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    };
    
    const handleSwipe = () => {
      const swipeThreshold = 50;
      const swipeDistance = touchStartX - touchEndX;
      
      if (Math.abs(swipeDistance) > swipeThreshold) {
        if (swipeDistance > 0) {
          // Swipe left, go next
          scrollNext();
        } else {
          // Swipe right, go prev
          scrollPrev();
        }
      }
    };
    
    // Add event listeners
    prevBtn.addEventListener('click', scrollPrev);
    nextBtn.addEventListener('click', scrollNext);
    slider.addEventListener('scroll', updateButtonStates);
    
    // Touch events for mobile
    slider.addEventListener('touchstart', handleTouchStart, { passive: true });
    slider.addEventListener('touchend', handleTouchEnd, { passive: true });
    
    // Initial button state
    updateButtonStates();
    
    // Update on resize
    window.addEventListener('resize', () => {
      setTimeout(updateButtonStates, 200);
    });
  });
</script>