<div class="product-detail-container">
    <div class="product-header">
      <div class="navigation-controls">
        <a href="javascript:history.back()" class="back-btn">
          <i class="fas fa-chevron-left"></i>
        </a>
        <div class="slide-controls">
          <span class="slide-indicator">1/<%= product.images ? product.images.length : 1 %></span>
        </div>
        <div class="action-controls">
          <a href="#" class="share-btn" id="shareButton">
            <i class="fas fa-share-alt"></i>
          </a>
          <a href="#" class="refresh-btn">
            <i class="fas fa-sync-alt"></i>
          </a>
        </div>
      </div>
      
      <div class="product-slider">
        <div class="main-image-container">
          <div class="slide-message">
            <h2>Rekomendasi Produks!</h2>
          </div>
          <div class="main-image" id="mainImage">
            <img src="<%= product.image %>" alt="<%= product.name %>">
          </div>
          
          <% if ((product.images && product.images.length > 0) || product.image) { %>
            <div class="image-navigation">
              <button class="nav-btn prev-btn" id="prevBtn">
                <i class="fas fa-chevron-left"></i>
              </button>
              <button class="nav-btn next-btn" id="nextBtn">
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          <% } %>
        </div>
        <% if ((product.images && product.images.length > 0) || product.image) { %>
          <div class="thumbnails-container">
            <div class="thumbnail-wrapper">
              <div class="thumbnail active" data-src="<%= product.image %>">
                <img src="<%= product.image %>" alt="<%= product.name %> - Main">
              </div>
              
              <% if (product.images && product.images.length > 0) { %>
                <% product.images.forEach((image, index) => { %>
                  <div class="thumbnail" data-src="<%= image %>">
                    <img src="<%= image %>" alt="<%= product.name %> - <%= index + 1 %>">
                  </div>
                <% }); %>
              <% } %>
            </div>
          </div>
        <% } %>
        <div class="bonus-info">
          <% if (product.bonusInfo && product.bonusInfo.length > 0) { %>
            <% product.bonusInfo.forEach(bonus => { %>
              <div class="bonus-item">
                <h3><%= bonus.title %></h3>
                <p><%= bonus.description %></p>
                <% if (bonus.image) { %>
                  <img src="<%= bonus.image %>" alt="<%= bonus.title %>" class="bonus-image">
                <% } %>
              </div>
            <% }); %>
          <% } else { %>
          <% } %>
        </div>
      </div>
    </div>
    
    <div class="commission-panel">
      <div class="commission-header">
        <% if (product.highCommission) { %>
          <div class="high-commission-badge">Komisi Tinggi</div>
        <% } %>
        <div class="total-commission">
          <div class="price-info">
            <% if (product.formattedDiscountPrice) { %>
              <span class="product-original-price"><%= product.formattedPrice %></span>
              <span class="product-price"><%= product.formattedDiscountPrice %></span>
            <% } else { %>
              <span class="product-price"><%= product.formattedPrice %></span>
            <% } %>
          </div>
          <div class="commission-info">
            Dapatkan komisi <span class="commission-value"><%= product.formattedTotalCommission %></span>/pcs 
            <span class="commission-percentage">(<%= product.commissionPercentage %>%)</span>
          </div>
        </div>
      </div>
      
      <!-- <div class="commission-details">
        <% if (product.commissionSources && product.commissionSources.length > 0) { %>
          <div class="commission-source tiktok">
            <div class="source-logo">
              <i class="<%= product.commissionSources[0].icon %>"></i>
              <span><%= product.commissionSources[0].name %></span>
            </div>
            <div class="source-amount">
              <div class="amount-value"><%= product.commissionSources[0].formattedAmount %></div>
              <div class="amount-rate">Tarif Komisi: <%= product.commissionSources[0].rate %>%</div>
            </div>
          </div>
          
          <div class="commission-plus">+</div>
          
          <div class="commission-source ibooming">
            <div class="source-logo">
              <span class="logo-circle">iB</span>
              <span><%= product.commissionSources[1].name %>&reg;</span>
            </div>
            <div class="source-amount">
              <div class="amount-value"><%= product.commissionSources[1].formattedAmount %></div>
              <div class="amount-rate">Tarif Cashback: <%= product.commissionSources[1].rate %>%</div>
            </div>
          </div>
        <% } else { %>
          <div class="commission-source">
            <div class="source-logo">
              <i class="fas fa-gift"></i>
              <span>Komisi Produk</span>
            </div>
            <div class="source-amount">
              <div class="amount-value"><%= product.formattedTotalCommission %></div>
              <div class="amount-rate">Tarif Komisi: <%= product.commissionPercentage %>%</div>
            </div>
          </div>
        <% } %>
      </div> -->
    </div>
</div>
    
    <div class="product-info">
        <h1 class="product-title"><%= product.name %></h1>
        
        <div class="product-description">
          <p><%= product.description %></p>
        </div>
        
        <div class="product-category">
          <span class="category-label"><%= product.category ? product.category.name : 'Perawatan & Kecantikan' %></span>
        </div>
        
        <div class="product-actions">
          <% if (user) { %>
            <a href="/products/<%= product._id %>/affiliate" class="buy-now-btn">
              <i class="fas fa-shopping-cart"></i> Tambah Ke Showcase
            </a>
            
            <% if (isInWishlist) { %>
              <a href="/user/wishlist/remove/<%= product._id %>?returnTo=/products/<%= product._id %>" class="add-favorites-btn wishlist-added" data-product-id="<%= product._id %>">
                <i class="fas fa-heart"></i> Tersimpan
              </a>
            <% } else { %>
              <a href="/user/wishlist/add/<%= product._id %>?returnTo=/products/<%= product._id %>" class="add-favorites-btn" data-product-id="<%= product._id %>">
                <i class="far fa-heart"></i> Simpan
              </a>
            <% } %>
          <% } else { %>
            <a href="/auth/login?returnTo=/products/<%= product._id %>/affiliate" class="buy-now-btn">
              <i class="fas fa-shopping-cart"></i> Tambah Ke Showcase
            </a>
            
            <a href="/auth/login?returnTo=/products/<%= product._id %>" class="add-favorites-btn">
              <i class="far fa-heart"></i> Simpan
            </a>
          <% } %>
      </div>
    </div>
    
    <div class="product-tabs">
      <div class="tabs-header">
        <button class="tab-btn active">Detail</button>
      </div>
      
      <div class="tab-content detail-tab">
        <div class="detail-content">
          <% if (product.detailInformation && product.detailInformation.trim()) { %>
            <div class="product-description-full">
              <%= product.detailInformation %>
            </div>
          <% } %>
          
          <% if (product.specifications && product.specifications.length > 0) { %>
            <h3>Spesifikasi Produk</h3>
            <ul class="spec-list">
              <% product.specifications.forEach(spec => { %>
                <li><strong><%= spec.label %>:</strong> <%= spec.value %></li>
              <% }); %>
            </ul>
          <% } %>
          
          <% if (product.howToUse && product.howToUse.length > 0) { %>
            <h3>Cara Penggunaan</h3>
            <ol class="usage-list">
              <% product.howToUse.forEach(step => { %>
                <li><%= step %></li>
              <% }); %>
            </ol>
          <% } %>
        </div>
      </div>
    </div>
    
    <div class="related-products-section">
      <h2 class="related-products-title">Produk Terkait</h2>
      
      <div class="related-products-container">
        <button class="related-nav-btn related-prev-btn" id="prevRelated">
          <i class="fas fa-chevron-left"></i>
        </button>
        
        <div class="related-products-slider" id="relatedSlider">
          <% relatedProducts.forEach(product => { %>
            <div class="related-product-item">
              <a href="/products/<%= product._id %>" class="related-product-link">
                <div class="related-product-image">
                  <img src="<%= product.image %>" alt="<%= product.name %>">
                  <% if (product.discountPrice && product.price > product.discountPrice) { %>
                    <div class="related-discount-tag">-<%= Math.round(((product.price - product.discountPrice) / product.price) * 100) %>%</div>
                  <% } %>
                </div>
                
                <div class="related-product-details">
                  <h3 class="related-product-name"><%= product.name.length > 40 ? product.name.substring(0, 40) + '...' : product.name %></h3>
                  
                  <div class="related-product-price">
                    <% if (product.discountPrice && product.price > product.discountPrice) { %>
                      <div class="related-old-price">Rp <%= product.price.toLocaleString('id-ID') %></div>
                      <div class="related-new-price">Rp <%= product.discountPrice.toLocaleString('id-ID') %></div>
                    <% } else { %>
                      <div class="related-current-price">Rp <%= product.price.toLocaleString('id-ID') %></div>
                    <% } %>
                  </div>
                  
                  <div class="related-product-commission">
                    Komisi: <span><%= product.totalCommission ? product.formattedCommission : 'Rp ' + (product.price * product.commission / 100).toLocaleString('id-ID') %></span>
                  </div>
                </div>
              </a>
              
              <a href="/products/<%= product._id %>" class="related-product-button">Lihat Produk</a>
            </div>
          <% }); %>
        </div>
        
        <button class="related-nav-btn related-next-btn" id="nextRelated">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>

    <div class="share-modal" id="shareModal">
      <div class="share-modal-content">
        <div class="share-modal-header">
          <h3>Bagikan Produk</h3>
          <button class="close-share-modal" id="closeShareModal">&times;</button>
        </div>
        <div class="share-modal-body">
          <div class="share-preview">
            <img src="<%= product.image %>" alt="<%= product.name %>" class="share-preview-img">
            <div class="share-preview-info">
              <h4><%= product.name %></h4>
              <p><%= product.description.length > 100 ? product.description.substring(0, 100) + '...' : product.description %></p>
            </div>
          </div>
          <div class="share-link-container">
            <input type="text" readonly id="shareLink" value="<%= typeof baseUrl !== 'undefined' ? baseUrl + '/products/' + product._id : '/products/' + product._id %>">
            <button id="copyLinkBtn" class="copy-link-btn">
              <i class="fas fa-copy"></i> Salin
            </button>
          </div>
          <div class="share-buttons">
            <a href="https://www.facebook.com/sharer/sharer.php?u=<%= encodeURIComponent(typeof baseUrl !== 'undefined' ? baseUrl + '/products/' + product._id : '/products/' + product._id) %>" target="_blank" class="share-button facebook">
              <i class="fab fa-facebook-f"></i>
              <span>Facebook</span>
            </a>
            <a href="https://twitter.com/intent/tweet?url=<%= encodeURIComponent(typeof baseUrl !== 'undefined' ? baseUrl + '/products/' + product._id : '/products/' + product._id) %>&text=<%= encodeURIComponent(`Cek produk ${product.name} di Taplink SIJAGO AI`) %>" target="_blank" class="share-button twitter">
              <i class="fab fa-twitter"></i>
              <span>Twitter</span>
            </a>
            <a href="https://api.whatsapp.com/send?text=<%= encodeURIComponent(`Cek produk ini di Taplink SIJAGO AI: ${product.name} ${typeof baseUrl !== 'undefined' ? baseUrl + '/products/' + product._id : '/products/' + product._id}`) %>" target="_blank" class="share-button whatsapp">
              <i class="fab fa-whatsapp"></i>
              <span>WhatsApp</span>
            </a>
            <a href="https://telegram.me/share/url?url=<%= encodeURIComponent(typeof baseUrl !== 'undefined' ? baseUrl + '/products/' + product._id : '/products/' + product._id) %>&text=<%= encodeURIComponent(`Cek produk ${product.name} di Taplink SIJAGO AI`) %>" target="_blank" class="share-button telegram">
              <i class="fab fa-telegram-plane"></i>
              <span>Telegram</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <style>
/* Add these styles to the existing CSS */
.price-info {
  margin-bottom: 5px;
}

.product-original-price {
  text-decoration: line-through;
  color: #999;
  font-size: 14px;
  margin-right: 5px;
}

.product-price {
  font-weight: 600;
  font-size: 16px;
  color: #333;
}

.commission-info {
  font-size: 16px;
  font-weight: 500;
}

.commission-percentage {
  font-size: 14px;
  color: #666;
  font-weight: normal;
}
.share-btn, .refresh-btn {
    width: 30px;
    height: 30px;
    background-color: rgba(255, 255, 255, 0.7);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #333;
    transition: all 0.2s;
  }
  
  .share-btn:hover, .refresh-btn:hover {
    background-color: white;
    transform: scale(1.1);
  }
  
  /* Share modal styles */
  .share-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }
  
  .share-modal.active {
    display: flex;
  }
  
  .share-modal-content {
    background-color: white;
    border-radius: 10px;
    width: 90%;
    max-width: 500px;
    overflow: hidden;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
  }
  
  .share-modal-header {
    padding: 15px 20px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .share-modal-header h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
  }
  
  .close-share-modal {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #999;
    line-height: 1;
  }
  
  .share-modal-body {
    padding: 20px;
  }
  
  .share-preview {
    display: flex;
    margin-bottom: 20px;
    background-color: #f5f5f8;
    border-radius: 8px;
    overflow: hidden;
  }
  
  .share-preview-img {
    width: 100px;
    height: 100px;
    object-fit: cover;
  }
  
  .share-preview-info {
    padding: 12px 15px;
    flex: 1;
  }
  
  .share-preview-info h4 {
    margin: 0 0 8px;
    font-size: 16px;
    font-weight: 600;
  }
  
  .share-preview-info p {
    margin: 0;
    font-size: 13px;
    color: #666;
    line-height: 1.4;
  }
  
  .share-link-container {
    display: flex;
    margin-bottom: 20px;
    border: 1px solid #ddd;
    border-radius: 6px;
    overflow: hidden;
  }
  
  #shareLink {
    flex: 1;
    padding: 10px 15px;
    border: none;
    outline: none;
    font-size: 14px;
    color: #555;
    background-color: #f5f5f8;
  }
  
  .copy-link-btn {
    padding: 0 15px;
    background-color: var(--primary-color);
    color: white;
    border: none;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    transition: background-color 0.2s;
  }
  
  .copy-link-btn:hover {
    background-color: #d02f50;
  }
  
  .copy-link-btn i {
    margin-right: 5px;
  }
  
  .share-buttons {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
  }
  
  .share-button {
    padding: 10px 0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    border-radius: 6px;
    font-size: 14px;
    transition: opacity 0.2s;
  }
  
  .share-button:hover {
    opacity: 0.9;
  }
  
  .share-button i {
    margin-right: 8px;
  }
  
  .facebook {
    background-color: #1877f2;
  }
  
  .twitter {
    background-color: #1da1f2;
  }
  
  .whatsapp {
    background-color: #25d366;
  }
  
  .telegram {
    background-color: #0088cc;
  }
  
  @media screen and (max-width: 480px) {
    .share-buttons {
      grid-template-columns: 1fr;
    }
  }
    .product-description-full {
    margin-bottom: 25px;
    line-height: 1.6;
    color: #333;
    white-space: pre-line; /* Preserves line breaks */
  }
  
  .detail-content h3 {
    font-size: 18px;
    font-weight: 600;
    margin: 20px 0 15px;
    color: #333;
  }
  
  .detail-content h3:first-child {
    margin-top: 0;
  }
  
  .spec-list {
    list-style: none;
    padding: 0;
    margin: 0 0 25px;
  }
  
  .spec-list li {
    padding: 10px 15px;
    border-bottom: 1px solid #eee;
    font-size: 14px;
    display: flex;
  }
  
  .spec-list li:last-child {
    border-bottom: none;
  }
  
  .spec-list li strong {
    width: 150px;
    color: #666;
    font-weight: 600;
  }
  
  .usage-list {
    padding-left: 25px;
    margin-bottom: 25px;
  }
  
  .usage-list li {
    margin-bottom: 12px;
    padding-left: 10px;
    font-size: 14px;
    line-height: 1.6;
  }
      .wishlist-added {
        background-color: #ffe6e6;
        color: #e74c3c;
      }
      
      .wishlist-added i {
        color: #e74c3c;
      }
    .product-detail-container {
      padding: 0;
      background-color: #f5f5f5;
    }
    
    .product-header {
      position: relative;
    }
    
    .navigation-controls {
      position: absolute;
      top: 10px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      padding: 0 15px;
      z-index: 10;
    }
    
    .back-btn, .share-btn, .refresh-btn {
      width: 30px;
      height: 30px;
      background-color: rgba(255, 255, 255, 0.7);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #333;
    }
    
    .action-controls {
      display: flex;
      gap: 10px;
    }
    
    .slide-indicator {
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      border-radius: 12px;
      padding: 2px 8px;
      font-size: 12px;
    }
    
    .product-slider {
      background-color: #c8c3c3;
      padding: 50px 15px 20px;
      border-radius: 0 0 15px 15px;
    }
    
    .slide-message {
      text-align: center;
      margin-bottom: 15px;
    }
    
    .slide-message h2 {
      font-size: 18px;
      font-weight: 600;
      color: #333;
    }
    
    .main-image {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    
    .main-image-container {
    position: relative;
    margin-bottom: 15px;
  }

    .main-image img {
      width: 100%;
      max-width: 100%;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .image-navigation {
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      transform: translateY(-50%);
      padding: 0 10px;
    }

    .nav-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.8);
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .nav-btn:hover {
      background-color: white;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
    }
    
    .nav-btn:focus {
      outline: none;
    }

    .thumbnails-container {
    margin-bottom: 20px;
    padding: 0 10px;
  }

  .thumbnail-wrapper {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding-bottom: 10px;
    scrollbar-width: thin;
  }

  .thumbnail-wrapper::-webkit-scrollbar {
    height: 8px;
  }

  .thumbnail-wrapper::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
  }
  
  .thumbnail-wrapper::-webkit-scrollbar-thumb {
    background: #ddd;
    border-radius: 10px;
  }
  
  .thumbnail-wrapper::-webkit-scrollbar-thumb:hover {
    background: #ccc;
  }
  
  .thumbnail {
    width: 70px;
    height: 70px;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    border: 2px solid transparent;
    transition: all 0.2s;
    flex-shrink: 0;
  }
  
  .thumbnail.active {
    border-color: var(--primary-color);
  }
  
  .thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  @media screen and (min-width: 768px) {
    .product-slider {
      display: flex;
      flex-direction: column;
      padding: 60px 30px 30px;
    }
    
    .main-image-container {
      max-width: 500px;
      margin: 0 auto;
    }
    
    .thumbnails-container {
      max-width: 500px;
      margin: 0 auto 20px auto;
    }
    
    .bonus-info {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }
    
    .bonus-item {
      flex: 1;
    }
  }
    
    .bonus-item h3 {
      color: #e03e52;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .bonus-item p {
      font-size: 12px;
      margin-bottom: 8px;
    }
    
    .bonus-image {
      max-width: 100%;
      height: auto;
      border-radius: 5px;
    }
    
    .commission-panel {
    background-color: white;
    border-radius: 10px;
    margin: 15px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    overflow: hidden;
  }
  
  .commission-header {
    padding: 12px 15px;
    background-color: #f5f5f8;
    display: flex;
    flex-direction: column;
  }
  
  .high-commission-badge {
    display: inline-block;
    background-color: #e74c3c;
    color: white;
    font-size: 12px;
    font-weight: 600;
    padding: 3px 8px;
    border-radius: 4px;
    margin-bottom: 8px;
    align-self: flex-start;
  }
  
  .total-commission {
    font-size: 16px;
    font-weight: 600;
  }
  
  .commission-value {
    color: #e03e52;
  }
    
    .commission-details {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      border-top: 1px solid #f0f0f0;
    }
    
    .commission-source {
      flex: 1;
    }
    
    .commission-plus {
      font-size: 18px;
      font-weight: 600;
      color: #e03e52;
      margin: 0 10px;
    }
    
    .source-logo {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }
    
    .source-logo i, .source-logo .logo-circle {
      margin-right: 5px;
      font-size: 14px;
    }
    
    .logo-circle {
      display: inline-block;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background-color: #333;
      color: white;
      text-align: center;
      line-height: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .source-amount {
      margin-left: 20px;
    }
    
    .amount-value {
      font-size: 16px;
      font-weight: 600;
    }
    
    .amount-rate {
      font-size: 12px;
      color: #777;
    }
    
    .product-info {
      padding: 15px;
      background-color: white;
      border-radius: 10px;
      margin: 15px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .product-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 10px;
      line-height: 1.4;
    }
    
    .product-description {
      font-size: 14px;
      color: #555;
      margin-bottom: 15px;
      line-height: 1.5;
    }
    
    .product-category {
      margin-bottom: 15px;
    }
    
    .category-label {
      display: inline-block;
      background-color: #f5f5f8;
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 12px;
      color: #666;
    }
    
    .product-actions {
      display: flex;
      gap: 10px;
    }
    
    .buy-now-btn {
      flex: 3;
      background-color: #e03e52;
      color: white;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      text-align: center;
    }
    
    .add-favorites-btn {
      flex: 1;
      background-color: #f5f5f8;
      color: #555;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      text-align: center;
    }
    
    .product-tabs {
      background-color: white;
      border-radius: 10px;
      margin: 15px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .tabs-header {
      display: flex;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .tab-btn {
      flex: 1;
      padding: 12px;
      text-align: center;
      font-size: 14px;
      background: none;
      border: none;
      color: #777;
      font-weight: 500;
    }
    
    .tab-btn.active {
      color: #e03e52;
      font-weight: 600;
      position: relative;
    }
    
    .tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 20%;
      right: 20%;
      height: 2px;
      background-color: #e03e52;
    }
    
    .tab-content {
      padding: 15px;
    }
    
    .detail-content h3 {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 10px;
      margin-top: 15px;
    }
    
    .detail-content h3:first-child {
      margin-top: 0;
    }
    
    .spec-list, .usage-list {
      padding-left: 20px;
      margin-bottom: 15px;
    }
    
    .spec-list li, .usage-list li {
      margin-bottom: 5px;
      font-size: 13px;
      color: #555;
    }
    
    .related-products-section {
  margin: 20px 15px;
  padding: 15px;
  background-color: #ffffff;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  position: relative;
}

.related-products-title {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 15px;
  padding-bottom: 8px;
  position: relative;
  color: #333333;
}

.related-products-title:after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 40px;
  height: 3px;
  background-color: #e03e52;
}

.related-products-container {
  position: relative;
  display: flex;
  align-items: center;
  margin: 0 -5px;
}

.related-nav-btn {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background-color: #f5f5f5;
  border: 1px solid #eeeeee;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: #666666;
  transition: all 0.2s ease;
  z-index: 2;
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
}

.related-nav-btn:hover {
  background-color: #e03e52;
  color: #ffffff;
  border-color: #e03e52;
}

.related-prev-btn {
  left: 5px;
}

.related-next-btn {
  right: 5px;
}

.related-products-slider {
  display: flex;
  overflow-x: auto;
  scroll-behavior: smooth;
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* Internet Explorer and Edge */
  padding: 10px 20px;
  width: 100%;
  gap: 15px;
}

.related-products-slider::-webkit-scrollbar {
  display: none; /* Chrome, Safari, and Opera */
}

.related-product-item {
  flex: 0 0 auto;
  width: calc(25% - 12px);
  min-width: 200px;
  background-color: #ffffff;
  border-radius: 8px;
  overflow: hidden;
  border: 1px solid #f0f0f0;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  transition: transform 0.3s, box-shadow 0.3s;
  display: flex;
  flex-direction: column;
}

.related-product-item:hover {
  transform: translateY(-5px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.related-product-link {
  text-decoration: none;
  color: inherit;
  display: block;
  flex-grow: 1;
}

.related-product-image {
  position: relative;
  padding-top: 100%; /* Square aspect ratio */
  background-color: #f9f9f9;
  overflow: hidden;
}

.related-product-image img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: contain;
  transition: transform 0.3s ease;
}

.related-product-item:hover .related-product-image img {
  transform: scale(1.05);
}

.related-discount-tag {
  position: absolute;
  top: 10px;
  right: 10px;
  background-color: #e03e52;
  color: #ffffff;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 600;
  z-index: 1;
}

.related-product-details {
  padding: 12px;
}

.related-product-name {
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 8px;
  line-height: 1.3;
  height: 36px;
  overflow: hidden;
  color: #333333;
}

.related-product-price {
  margin-bottom: 5px;
}

.related-old-price {
  text-decoration: line-through;
  color: #999999;
  font-size: 12px;
  margin-bottom: 2px;
}

.related-new-price,
.related-current-price {
  font-weight: 700;
  color: #e03e52;
  font-size: 15px;
}

.related-product-commission {
  font-size: 12px;
  color: #4caf50;
  margin-bottom: 10px;
}

.related-product-commission span {
  font-weight: 500;
}

.related-product-button {
  display: block;
  background-color: #e03e52;
  color: #ffffff;
  text-align: center;
  padding: 8px 0;
  font-size: 13px;
  font-weight: 500;
  text-decoration: none;
  transition: background-color 0.2s;
  margin-top: auto;
  border-radius: 0 0 8px 8px;
}

.related-product-button:hover {
  background-color: #d03045;
}

.product-description-full {
    margin-bottom: 25px;
    line-height: 1.6;
    color: #333;
    white-space: pre-line; /* Preserves line breaks */
  }
  
  .detail-content h3 {
    font-size: 18px;
    font-weight: 600;
    margin: 20px 0 15px;
    color: #333;
  }
  
  .detail-content h3:first-child {
    margin-top: 0;
  }
  
  .spec-list {
    list-style: none;
    padding: 0;
    margin: 0 0 25px;
  }
  
  .spec-list li {
    padding: 10px 15px;
    border-bottom: 1px solid #eee;
    font-size: 14px;
    display: flex;
  }
  
  .spec-list li:last-child {
    border-bottom: none;
  }
  
  .spec-list li strong {
    width: 150px;
    color: #666;
    font-weight: 600;
  }
  
  .usage-list {
    padding-left: 25px;
    margin-bottom: 25px;
  }
  
  .usage-list li {
    margin-bottom: 12px;
    padding-left: 10px;
    font-size: 14px;
    line-height: 1.6;
  }


/* Responsive styles */
@media (max-width: 1024px) {
  .related-product-item {
    width: calc(33.333% - 10px);
  }
}

@media (max-width: 768px) {
  .related-product-item {
    width: calc(50% - 10px);
    min-width: 150px;
  }
  
  .related-nav-btn {
    width: 28px;
    height: 28px;
    font-size: 12px;
  }
  
  .related-products-slider {
    padding: 10px 15px;
  }
}

@media (max-width: 480px) {
  .related-products-section {
    margin: 15px 10px;
    padding: 12px;
  }
  
  .related-products-title {
    font-size: 16px;
    margin-bottom: 12px;
    text-align: center;
  }
  
  .related-product-item {
    width: 70%;
    min-width: 140px;
  }
  
  .related-nav-btn {
    opacity: 0.7;
    width: 24px;
    height: 24px;
  }
  
  .related-prev-btn {
    left: 2px;
  }
  
  .related-next-btn {
    right: 2px;
  }
  
  .related-products-slider {
    padding: 10px 10px;
  }
  
  .related-product-name {
    font-size: 13px;
    height: 34px;
  }
}
    
    @media screen and (min-width: 768px) {
      .product-slider {
        display: flex;
        padding: 60px 30px 30px;
      }
      
      .main-image {
        flex: 3;
        margin-right: 30px;
        margin-bottom: 0;
      }
      
      .bonus-info {
        flex: 2;
        flex-direction: column;
        margin-top: 0;
      }
      
      .bonus-item {
        margin-bottom: 20px;
      }
      
      .commission-panel {
        margin: 20px;
      }
      
      .product-info, .product-tabs {
        margin: 20px;
      }
      
      .product-actions {
        max-width: 400px;
      }
      
      .product-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }
  </style>

<!-- Add this at the bottom of your views/products/detail.ejs file -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Share functionality
    const shareButton = document.getElementById('shareButton');
    const shareModal = document.getElementById('shareModal');
    const closeShareModal = document.getElementById('closeShareModal');
    const copyLinkBtn = document.getElementById('copyLinkBtn');
    const shareLink = document.getElementById('shareLink');
    
    if (shareButton && shareModal) {
      // Open share modal
      shareButton.addEventListener('click', function(e) {
        e.preventDefault();
        shareModal.classList.add('active');
      });
      
      // Close share modal
      if (closeShareModal) {
        closeShareModal.addEventListener('click', function() {
          shareModal.classList.remove('active');
        });
      }
      
      // Close modal when clicking outside
      shareModal.addEventListener('click', function(e) {
        if (e.target === shareModal) {
          shareModal.classList.remove('active');
        }
      });
      
      // Copy link to clipboard
      if (copyLinkBtn && shareLink) {
        copyLinkBtn.addEventListener('click', function() {
          shareLink.select();
          shareLink.setSelectionRange(0, 99999); // For mobile
          
          try {
            document.execCommand('copy');
            const originalText = copyLinkBtn.innerHTML;
            copyLinkBtn.innerHTML = '<i class="fas fa-check"></i> Tersalin!';
            
            setTimeout(function() {
              copyLinkBtn.innerHTML = originalText;
            }, 2000);
          } catch (err) {
            console.error('Failed to copy', err);
          }
        });
      }
    }
    
    // Web Share API if available (for mobile devices)
    if (shareButton && navigator.share) {
      shareButton.addEventListener('click', async (e) => {
        e.preventDefault();
        
        try {
          await navigator.share({
            title: '<%= product.name %>',
            text: '<%= product.description.length > 100 ? product.description.substring(0, 100) + "..." : product.description %>',
            url: document.location.href // Use the current URL instead of constructing it
          });
          console.log('Content shared successfully');
        } catch (err) {
          console.log('Error sharing:', err);
          // Fallback to our custom share modal
          shareModal.classList.add('active');
        }
      });
    }

    // ===== PRODUCT IMAGE GALLERY =====
    const mainImage = document.getElementById('mainImage')?.querySelector('img');
    const thumbnails = document.querySelectorAll('.thumbnail');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    
    if (mainImage && thumbnails.length > 0) {
      // Store all image sources in an array
      const imageSources = [];
      thumbnails.forEach(thumb => {
        imageSources.push(thumb.getAttribute('data-src'));
      });
      
      let currentImageIndex = 0;
      
      // Function to update the main image
      function updateMainImage(index) {
        // Update active thumbnail
        thumbnails.forEach(thumb => {
          thumb.classList.remove('active');
        });
        
        thumbnails[index].classList.add('active');
        
        // Update main image with smooth transition
        mainImage.style.opacity = '0';
        
        setTimeout(() => {
          mainImage.src = imageSources[index];
          mainImage.style.opacity = '1';
        }, 200);
        
        // Update current index
        currentImageIndex = index;
        
        // Update slide indicator if it exists
        const slideIndicator = document.querySelector('.slide-indicator');
        if (slideIndicator) {
          slideIndicator.textContent = `${currentImageIndex + 1}/${imageSources.length}`;
        }
      }
      
      // Add click event to thumbnails
      thumbnails.forEach((thumb, index) => {
        thumb.addEventListener('click', () => {
          updateMainImage(index);
        });
      });
      
      // Add click events to navigation buttons
      if (prevBtn && nextBtn) {
        prevBtn.addEventListener('click', () => {
          let newIndex = currentImageIndex - 1;
          if (newIndex < 0) {
            newIndex = imageSources.length - 1;
          }
          updateMainImage(newIndex);
        });
        
        nextBtn.addEventListener('click', () => {
          let newIndex = currentImageIndex + 1;
          if (newIndex >= imageSources.length) {
            newIndex = 0;
          }
          updateMainImage(newIndex);
        });
      }
      
      // Initialize slide indicator
      const slideIndicator = document.querySelector('.slide-indicator');
      if (slideIndicator && imageSources.length > 0) {
        slideIndicator.textContent = `1/${imageSources.length}`;
      }
      
      // Add swipe functionality for mobile
      let touchStartX = 0;
      let touchEndX = 0;
      
      const mainImageContainer = document.querySelector('.main-image-container');
      
      if (mainImageContainer) {
        mainImageContainer.addEventListener('touchstart', e => {
          touchStartX = e.changedTouches[0].screenX;
        });
        
        mainImageContainer.addEventListener('touchend', e => {
          touchEndX = e.changedTouches[0].screenX;
          handleSwipe();
        });
      }
      
      function handleSwipe() {
        const swipeThreshold = 50; // Minimum swipe distance
        
        if (touchStartX - touchEndX > swipeThreshold) {
          // Swipe left, go to next image
          let newIndex = currentImageIndex + 1;
          if (newIndex >= imageSources.length) {
            newIndex = 0;
          }
          updateMainImage(newIndex);
        }
        
        if (touchEndX - touchStartX > swipeThreshold) {
          // Swipe right, go to previous image
          let newIndex = currentImageIndex - 1;
          if (newIndex < 0) {
            newIndex = imageSources.length - 1;
          }
          updateMainImage(newIndex);
        }
      }
      
      // Add keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') {
          // Left arrow key, go to previous image
          let newIndex = currentImageIndex - 1;
          if (newIndex < 0) {
            newIndex = imageSources.length - 1;
          }
          updateMainImage(newIndex);
        }
        
        if (e.key === 'ArrowRight') {
          // Right arrow key, go to next image
          let newIndex = currentImageIndex + 1;
          if (newIndex >= imageSources.length) {
            newIndex = 0;
          }
          updateMainImage(newIndex);
        }
      });
    }
    
    // ===== WISHLIST BUTTON =====
    const wishlistButtons = document.querySelectorAll('.add-favorites-btn');
    
    wishlistButtons.forEach(button => {
      button.addEventListener('click', function(e) {
        <% if (user) { %>
          e.preventDefault();
          
          const productId = this.getAttribute('data-product-id');
          const isAdded = this.classList.contains('wishlist-added');
          const endpoint = isAdded ? 
            `/user/wishlist/remove/${productId}` : 
            `/user/wishlist/add/${productId}`;
          
          fetch(endpoint, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            }
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              if (isAdded) {
                this.classList.remove('wishlist-added');
                this.innerHTML = '<i class="far fa-heart"></i> Simpan';
              } else {
                this.classList.add('wishlist-added');
                this.innerHTML = '<i class="fas fa-heart"></i> Tersimpan';
              }
            } else {
              alert(data.message);
            }
          })
          .catch(error => {
            console.error('Error:', error);
          });
        <% } %>
      });
    });
    
    // ===== RELATED PRODUCTS SLIDER =====
    const relatedSlider = document.getElementById('relatedSlider');
    const prevRelatedBtn = document.getElementById('prevRelated');
    const nextRelatedBtn = document.getElementById('nextRelated');
    
    if (relatedSlider && prevRelatedBtn && nextRelatedBtn) {
      // Scroll amount based on container and device
      const getScrollAmount = () => {
        const items = relatedSlider.querySelectorAll('.related-product-item');
        if (items.length === 0) return 0;
        
        // Use item width plus gap
        return items[0].offsetWidth + 15;
      };
      
      // Scroll by one item
      const scrollPrev = () => {
        relatedSlider.scrollBy({
          left: -getScrollAmount(),
          behavior: 'smooth'
        });
      };
      
      const scrollNext = () => {
        relatedSlider.scrollBy({
          left: getScrollAmount(),
          behavior: 'smooth'
        });
      };
      
      // Update button states based on scroll position
      const updateButtonStates = () => {
        // Check if at start or end
        const isAtStart = relatedSlider.scrollLeft < 10;
        const isAtEnd = relatedSlider.scrollLeft >= relatedSlider.scrollWidth - relatedSlider.clientWidth - 10;
        
        // Update button visibility
        prevRelatedBtn.style.opacity = isAtStart ? '0.4' : '0.7';
        nextRelatedBtn.style.opacity = isAtEnd ? '0.4' : '0.7';
        prevRelatedBtn.style.cursor = isAtStart ? 'default' : 'pointer';
        nextRelatedBtn.style.cursor = isAtEnd ? 'default' : 'pointer';
        
        // Disable buttons at limits
        prevRelatedBtn.disabled = isAtStart;
        nextRelatedBtn.disabled = isAtEnd;
      };
      
      // Mobile swipe handling for related products
      let relatedTouchStartX = 0;
      let relatedTouchEndX = 0;
      
      const handleRelatedTouchStart = (e) => {
        relatedTouchStartX = e.changedTouches[0].screenX;
      };
      
      const handleRelatedTouchEnd = (e) => {
        relatedTouchEndX = e.changedTouches[0].screenX;
        handleRelatedSwipe();
      };
      
      const handleRelatedSwipe = () => {
        // Minimum distance required for a swipe
        const swipeThreshold = 50;
        const swipeDistance = relatedTouchStartX - relatedTouchEndX;
        
        if (Math.abs(swipeDistance) > swipeThreshold) {
          if (swipeDistance > 0) {
            // Swipe left, go next
            scrollNext();
          } else {
            // Swipe right, go prev
            scrollPrev();
          }
        }
      };
      
      // Add event listeners for related products
      prevRelatedBtn.addEventListener('click', scrollPrev);
      nextRelatedBtn.addEventListener('click', scrollNext);
      relatedSlider.addEventListener('scroll', updateButtonStates);
      
      // Mobile swipe support for related products
      relatedSlider.addEventListener('touchstart', handleRelatedTouchStart, { passive: true });
      relatedSlider.addEventListener('touchend', handleRelatedTouchEnd, { passive: true });
      
      // Initialize related products slider
      updateButtonStates();
      
      // Recalculate on resize
      window.addEventListener('resize', () => {
        setTimeout(updateButtonStates, 200);
      });
    }
  });
</script>